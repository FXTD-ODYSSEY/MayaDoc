<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>bakeDeformer command</title>
      <meta name="section" content="Commands">
      <meta name="module" content="MEL and expressions">
      <script src="../style/tech.js">.</script>
      <script src="../style/document.js">.</script>
      <link rel="StyleSheet" href="../style/tech.css" type="text/css" media="all">
    <meta name="contextid" content="Commands-bakeDeformer"></head>
    <body class="command" onload="highLightSearch();">
      <div id="banner">
		<table width="100%"><tr>
			<td><font size="-1"><b>command</b> (MEL)</font></td>
			<td align="right"><font size="-1"><i><a href="../CommandsPython/bakeDeformer.html">Python version</a></i></font></td>
		  </tr><tr>
		  <td><h1>bakeDeformer </h1></td>
			<td align="right">In categories: <a href="cat_Animation.html" target="contentFrame">Animation</a>, <a href="cat_Animation.html#Deformation" target="contentFrame">Deformation</a></td>
		  </tr></table>
      </div>
      <p class="toolbar" align="right">
		<script>toolbar("bakeDeformer.html");</script>
      </p>
      <p>Go to: <a href="#hSynopsis">Synopsis</a>. <a href="#hReturn">Return value</a>. <a href="#hKeywords">Keywords</a>. <a href="#hRelated">Related</a>. <a href="#hFlags">Flags</a>. <a href="#hExamples">MEL examples</a>. </p>

      <h2><a name="hSynopsis">Synopsis</a></h2>
      <p id="synopsis"> <code>bakeDeformer [-<a href="#flagcolorizeSkeleton">colorizeSkeleton</a> <i>boolean</i>] [-<a href="#flagcustomRangeOfMotion">customRangeOfMotion</a> <i>timerange</i>] [-<a href="#flagdstMeshName">dstMeshName</a> <i>string</i>] [-<a href="#flagdstSkeletonName">dstSkeletonName</a> <i>string</i>] [-<a href="#flaghierarchy">hierarchy</a> <i>boolean</i>] [-<a href="#flaginfluences">influences</a> <i>string[]</i>] [-<a href="#flagmaxInfluences">maxInfluences</a> <i>int</i>] [-<a href="#flagpruneWeights">pruneWeights</a> <i>float</i>] [-<a href="#flagsmoothWeights">smoothWeights</a> <i>int</i>] [-<a href="#flagsrcMeshName">srcMeshName</a> <i>string</i>] [-<a href="#flagsrcSkeletonName">srcSkeletonName</a> <i>string</i>]  </code> </p>
      <p>bakeDeformer is undoable, <b>NOT queryable</b>, and <b>NOT editable</b>.</p>
      Given a rigged character, whose mesh shape is determined by a set of deformers, bakeDeformer calculates linear blend skin weights most closely approximating observed deformations. To do this, a test set of examples is generated by moving the rig through a range of motion. Results mesh and pose pairs are then used to solve a constrained optimization, solving for skinning weights. bakeDeformer automatically binds and applies resulting weights to the destination geometry. If the source and destination mesh/skeleton are identical, the command will replace the original deformations with a skinCluster and computed weights. See the below examples for sample usage.
	  
      <h2><a name="hReturn">Return value</a></h2>
      <table><tr><td valign="top"><i>string</i></td><td>BakeDeformer name</td></tr></table>
      <h2><a name="hKeywords">Keywords</a></h2>bake, skinning, deformer
      <h2><a name="hRelated">Related</a></h2><a href="skinPercent.html">skinPercent</a>

      
    <h2><a name="hFlags">Flags</a></h2>
      <a href="#flagcolorizeSkeleton">colorizeSkeleton</a>, <a href="#flagcustomRangeOfMotion">customRangeOfMotion</a>, <a href="#flagdstMeshName">dstMeshName</a>, <a href="#flagdstSkeletonName">dstSkeletonName</a>, <a href="#flaghierarchy">hierarchy</a>, <a href="#flaginfluences">influences</a>, <a href="#flagmaxInfluences">maxInfluences</a>, <a href="#flagpruneWeights">pruneWeights</a>, <a href="#flagsmoothWeights">smoothWeights</a>, <a href="#flagsrcMeshName">srcMeshName</a>, <a href="#flagsrcSkeletonName">srcSkeletonName</a>
      <table width="100%">
        <tr>
          <th bgcolor="#CCCCCC">Long name (short name)</th>
          <th bgcolor="#CCCCCC"><i>Argument types</i></th>
          <th bgcolor="#CCCCCC">Properties</th>
        </tr>
        
    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagcolorizeSkeleton">
          <code><b>-colorizeSkeleton</b>(<b>-cs</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>boolean</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The new skin cluster created will have its skeleton colorized. Must be used with the -srcSkeletonName and -dstSkeletonName flags.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagcustomRangeOfMotion">
          <code><b>-customRangeOfMotion</b>(<b>-rom</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>timerange</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

When this flag is specified with the frames for the range of motion to be used, the tool will step through
each frame as a separate pose. Otherwise the tool will use the existing range of motion in the tool
that rotates each influence 45 degrees.
<p>
    Usage examples:
    <ul>
        <li> -rom &quot;10:20&quot; means all frames in the range from 10 to 20, inclusive, in the current time unit. </li>
        <li> Omitting one end of a range means using either end of the animation range (or both), as in the following examples: </li>
        <li> -rom &quot;10:&quot; means all frames from time 10 (in the current time unit) onwards to the maximum time in the animation range (on the timeline). </li>
        <li> -rom &quot;:10&quot; means all frames from the minimum time on the animation range (on the timeline) up to (and including) time 10 (in the current time unit). </li>
        <li> -rom &quot;:&quot; is a short form to specify all frames, from minimum to maximum time on the current animation range. </li>
    </ul>

<p>
When using this flag, some of the joints in the specified range of motion may not have changed sufficiently.
To improve bakeDeformer results or avoid algorithm errors, the command will return a list of influences that do not move enough in the specified range of motion.
To detect these joints, the <b>local</b> transformation of each joint is compared between subsequent frames.
We consider that a joint has sufficiently changed if any of the below criteria are met:
    <ul>
        <li>There is a rotation of at least 5 degrees, as determined by the shortest rotation between transforms.</li>
        <li>There is a translation of 1% or greater of the size of the largest bounding box containing all joints for each frame.</li>
        <li>There is a scaling change of at least 1%. This percentage represents the smallest scaling value over the largest scaling value (in absolute value).</li>
    </ul>
    <p>
    If a joint has not met any of the criteria, it will be added to the warning of joints that have not moved enough.
    

<p>
<b>The custom range of motion should be considered experimental.</b>

			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagdstMeshName">
          <code><b>-dstMeshName</b>(<b>-dm</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>string</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The destination mesh name.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagdstSkeletonName">
          <code><b>-dstSkeletonName</b>(<b>-ds</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>string</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The destination skeleton name.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flaghierarchy">
          <code><b>-hierarchy</b>(<b>-hi</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>boolean</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

All children of the passed joints that are used in the influences flag are used.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flaginfluences">
          <code><b>-influences</b>(<b>-i</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>string[]</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

A list of joints that are used as the influences to determine new weights.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagmaxInfluences">
          <code><b>-maxInfluences</b>(<b>-mi</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>int</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The maximum number of influences per vertex.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagpruneWeights">
          <code><b>-pruneWeights</b>(<b>-pw</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>float</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

On the newly created skin cluster, set any weight below the given the value to zero (post-processing).
This will call the skinPercent command as follows: &quot;skinPercent -pruneWeights [value] [skinClusterName] [dstMeshName]&quot;
where [value] is the value passed into this flag, [skinClusterName] is the name of the new skinCluster node created
after running this tool, and [dstMeshName] is the mesh provided in the -dstMeshName flag.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagsmoothWeights">
          <code><b>-smoothWeights</b>(<b>-sw</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>int</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The number of smoothing iterations for smoothing weights (post-processing). This also renormalizes the remaining the weights.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagsrcMeshName">
          <code><b>-srcMeshName</b>(<b>-sm</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>string</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The source mesh name.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>


    <tr bgcolor="#EEEEEE">
      <td valign="top">
        <a name="flagsrcSkeletonName">
          <code><b>-srcSkeletonName</b>(<b>-ss</b>)</code></a> 
      </td>
      <td valign="top">
        <code><i>string</i></code>
      </td>
      <td valign="top">
<img src="../gfx/create.gif" alt="create" title="create" width="13" height="16" hspace="2" vspace="2">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <table width="100%">
          <tr>
        <td width="5%"></td>
          <td>

The source skeleton name.
			
          </td>
          </tr>
        </table>
      </td>
    </tr>

      </table>
      <hr>
        <table border="0" cellspacing="1" cellpadding="4" bgcolor="#EEEEEE">
          <tr>
            <td valign="top"><img hspace="2" height="16" width="14" src="../gfx/create.gif">
                Flag can appear in Create mode of command
            </td>
            <td valign="top"><img hspace="2" height="16" width="14" src="../gfx/edit.gif">
                Flag can appear in Edit mode of command
            </td>
          </tr>
          <tr>
            <td valign="top"><img hspace="2" height="16" width="14" src="../gfx/query.gif">
                Flag can appear in Query mode of command
            </td>
            <td valign="top"><img hspace="2" height="16" width="14" src="../gfx/multiuse.gif">
                Flag can be used more than once in a command.
            </td>
          </tr>
        </table>


<h2><a name="hExamples">MEL examples</a></h2><pre>

proc string[] createJointsAndMesh(float $offset[])
{
    string $root = `joint`;
    joint; move -r 0 2 0;
    joint; move -r 0 2 0;
    joint; move -r 0 2 0;
    joint; move -r 0 2 0;
    joint; move -r 0 2 0;

    string $meshes[] = `polyCube -sx 3 -sy 10 -sz 3 -h 10`;
    move -r 0 5 0;

    select -r $root $meshes;
    move -r $offset[0] $offset[1] $offset[2];
    select -cl;

    return {$root, $meshes[0]};
}

proc bindMesh(string $object[])
{
    string $rootJoint = $object[0];
    string $mesh      = $object[1];
    select -r -hi $rootJoint;
    select -add $mesh;
    SmoothBindSkin;
    select -cl;
}

proc randomizeJoints(string $object[])
{
    string $rootJoint = $object[0];
    select -r $rootJoint;
    pickWalk -d down;
    for ($i=0; $i&lt;4; $i++)
    {
        float $rads[] = `sphrand 1.`;
        rotate(
            rad_to_deg($rads[0]),
            rad_to_deg($rads[1]),
            rad_to_deg($rads[2]));
        pickWalk -d down;
    }
}

proc matchRotations(string $src, string $dst)
{
    select -r -hi $src;
    string $srcChain[] = `ls -sl`;

    select -r -hi $dst;
    string $dstChain[] = `ls -sl`;

    for ($i=0; $i&lt;5; $i++)
    {
        select -r $dstChain[$i] $srcChain[$i];
        MatchRotation;
    }
}

{
    // Create an empty scene
    file -f -new;

    // Create two joint chains/meshes
    string $object1[] = createJointsAndMesh({0, 0, 0});
    string $object2[] = createJointsAndMesh({5, 0, 0});

    // Bind one of the joint chains to the mesh and rotate the weights
    bindMesh($object1);
    randomizeJoints($object1);

    // Use bakeDeformer to learn and apply the linear blend skinning weights.
    // Specify the source/destination skeletons and meshes and the number of maximum influences.
    bakeDeformer
        -ss $object1[0] -sm $object1[1]
        -ds $object2[0] -dm $object2[1]
        -mi 3;

    // Match the rotations of the two chains to show the results are similar
    matchRotations($object1[0], $object2[0]);
}
	</pre>































    </body>
  </html>
  

